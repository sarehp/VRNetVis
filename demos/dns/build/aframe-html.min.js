!function(e){"use strict";class t extends e.Mesh{constructor(t){const o=new i(t),n=new e.PlaneGeometry(.001*o.image.width,.001*o.image.height),s=new e.MeshBasicMaterial({map:o,toneMapped:!1,transparent:!0});function r(e){s.map.dispatchDOMEvent(e)}super(n,s),this.addEventListener("mousedown",r),this.addEventListener("mousemove",r),this.addEventListener("mouseup",r),this.addEventListener("click",r),this.dispose=function(){n.dispose(),s.dispose(),s.map.dispose(),this.removeEventListener("mousedown",r),this.removeEventListener("mousemove",r),this.removeEventListener("mouseup",r),this.removeEventListener("click",r)}}}class i extends e.CanvasTexture{constructor(t){super(n(t)),this.dom=t,this.anisotropy=16,this.encoding=e.sRGBEncoding,this.minFilter=e.LinearFilter,this.magFilter=e.LinearFilter;const i=new MutationObserver((()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout((()=>this.update()),16))}));i.observe(t,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.observer=i}dispatchDOMEvent(e){e.data&&function(e,t,i,o){const n={clientX:i*e.offsetWidth+e.offsetLeft,clientY:o*e.offsetHeight+e.offsetTop,view:e.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(t,n));const s=e.getBoundingClientRect();function r(e){if(e.nodeType!==Node.TEXT_NODE&&e.nodeType!==Node.COMMENT_NODE){const s=e.getBoundingClientRect();if(i>s.left&&i<s.right&&o>s.top&&o<s.bottom&&(e.dispatchEvent(new MouseEvent(t,n)),e instanceof HTMLInputElement&&"range"===e.type&&("mousedown"===t||"click"===t))){const[t,o]=["min","max"].map((t=>parseFloat(e[t]))),n=s.width,r=(i-s.x)/n;e.value=t+(o-t)*r,e.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let t=0;t<e.childNodes.length;t++)r(e.childNodes[t])}}i=i*s.width+s.left,o=o*s.height+s.top,r(e)}(this.dom,e.type,e.data.x,e.data.y)}update(){this.image=n(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const o=new WeakMap;function n(t){const i=document.createRange(),n=new e.Color;function s(e,t,i,o){""!==o&&("uppercase"===e.textTransform&&(o=o.toUpperCase()),d.font=e.fontWeight+" "+e.fontSize+" "+e.fontFamily,d.textBaseline="top",d.fillStyle=e.color,d.fillText(o,t,i+.1*parseFloat(e.fontSize)))}function r(e,t,i,o,n){i<2*n&&(n=i/2),o<2*n&&(n=o/2),d.beginPath(),d.moveTo(e+n,t),d.arcTo(e+i,t,e+i,t+o,n),d.arcTo(e+i,t+o,e,t+o,n),d.arcTo(e,t+o,e,t,n),d.arcTo(e,t,e+i,t,n),d.closePath()}function l(e,t,i,o,n,s){const r=e[t+"Width"],l=e[t+"Style"],a=e[t+"Color"];"0px"!==r&&"none"!==l&&"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a&&(d.strokeStyle=a,d.lineWidth=parseFloat(r),d.beginPath(),d.moveTo(i,o),d.lineTo(i+n,o+s),d.stroke())}const a=t.getBoundingClientRect();let h;o.has(t)?h=o.get(t):(h=document.createElement("canvas"),h.width=a.width,h.height=a.height);const d=h.getContext("2d"),c=new function(e){const t=[];let i=!1;function o(){if(i&&(i=!1,e.restore()),0===t.length)return;let o=-1/0,n=-1/0,s=1/0,r=1/0;for(let e=0;e<t.length;e++){const i=t[e];o=Math.max(o,i.x),n=Math.max(n,i.y),s=Math.min(s,i.x+i.width),r=Math.min(r,i.y+i.height)}e.save(),e.beginPath(),e.rect(o,n,s-o,r-n),e.clip(),i=!0}return{add:function(e){t.push(e),o()},remove:function(){t.pop(),o()}}}(d);return function e(t,o){let h=0,p=0,m=0,u=0;if(t.nodeType===Node.TEXT_NODE){i.selectNode(t);const e=i.getBoundingClientRect();h=e.left-a.left-.5,p=e.top-a.top-.5,m=e.width,u=e.height,s(o,h,p,t.nodeValue.trim())}else{if(t.nodeType===Node.COMMENT_NODE)return;if(t instanceof HTMLCanvasElement){if("none"===t.style.display)return;d.save();const e=window.devicePixelRatio;d.scale(1/e,1/e),d.drawImage(t,0,0),d.restore()}else{if("none"===t.style.display)return;const e=t.getBoundingClientRect();h=e.left-a.left-.5,p=e.top-a.top-.5,m=e.width,u=e.height;const i=(o=window.getComputedStyle(t)).backgroundColor;r(h,p,m,u,parseFloat(o.borderRadius)),"transparent"!==i&&"rgba(0, 0, 0, 0)"!==i&&(d.fillStyle=i,d.fill());const f=["borderTop","borderLeft","borderBottom","borderRight"];let v=!0,E=null;for(const e of f){if(E&&(v=o[e+"Width"]===o[E+"Width"]&&o[e+"Color"]===o[E+"Color"]&&o[e+"Style"]===o[E+"Style"]),!v)break;E=e}if(v){const e=parseFloat(o.borderTopWidth);"0px"!==o.borderTopWidth&&"none"!==o.borderTopStyle&&"transparent"!==o.borderTopColor&&"rgba(0, 0, 0, 0)"!==o.borderTopColor&&(d.strokeStyle=o.borderTopColor,d.lineWidth=e,d.stroke())}else l(o,"borderTop",h,p,m,0),l(o,"borderLeft",h,p,0,u),l(o,"borderBottom",h,p+u,m,0),l(o,"borderRight",h+m,p,0,u);if(t instanceof HTMLInputElement){let e=o.accentColor;void 0!==e&&"auto"!==e||(e=o.color),n.set(e);const i=Math.sqrt(.299*n.r**2+.587*n.g**2+.114*n.b**2)<.5?"white":"#111111";if("radio"===t.type&&(r(h,p,m,u,u),d.fillStyle="white",d.strokeStyle=e,d.lineWidth=1,d.fill(),d.stroke(),t.checked)){const t=2;r(h+t,p+t,m-2*t,u-2*t,u),d.fillStyle=e,d.strokeStyle=i,d.lineWidth=t,d.fill(),d.stroke()}if("checkbox"===t.type&&(r(h,p,m,u,2),d.fillStyle=t.checked?e:"white",d.strokeStyle=t.checked?i:e,d.lineWidth=1,d.stroke(),d.fill(),t.checked)){const e=d.textAlign;d.textAlign="center",s({color:i,fontFamily:o.fontFamily,fontSize:u+"px",fontWeight:"bold"},h+m/2,p,"âœ”"),d.textAlign=e}if("range"===t.type){const[o,n,s]=["min","max","value"].map((e=>parseFloat(t[e]))),l=(s-o)/(n-o)*(m-u);r(h,p+.25*u,m,.5*u,.25*u),d.fillStyle=i,d.strokeStyle=e,d.lineWidth=1,d.fill(),d.stroke(),r(h,p+.25*u,l+.5*u,.5*u,.25*u),d.fillStyle=e,d.fill(),r(h+l,p,u,u,.5*u),d.fillStyle=e,d.fill()}"color"!==t.type&&"text"!==t.type&&"number"!==t.type||(c.add({x:h,y:p,width:m,height:u}),s(o,h+parseInt(o.paddingLeft),p+parseInt(o.paddingTop),t.value),c.remove())}}}const f="auto"===o.overflow||"hidden"===o.overflow;f&&c.add({x:h,y:p,width:m,height:u});for(let i=0;i<t.childNodes.length;i++)e(t.childNodes[i],o);f&&c.remove()}(t),h}const s={type:"",data:new THREE.Vector2},r=new THREE.Vector3,l=new THREE.Vector3;AFRAME.registerComponent("html-pointer",{schema:{activationType:{oneOf:["event","proximity"],default:"event"},proximityElA:{type:"selector"},proximityElB:{type:"selector"},proximityTrigger:{default:.015},downEvents:{type:"array",default:["selectstart"]},upEvents:{type:"array",default:["selectend"]},clickEvents:{type:"array",default:["select"]}},init(){this.htmlEl=null,this.onDown=e=>this.handle("mousedown",e),this.onUp=e=>this.handle("mouseup",e),this.onClick=e=>this.handle("click",e),this.onIntersection=e=>this.htmlEl=e.detail.els[0],this.onIntersectionCleared=e=>this.htmlEl=null,this.el.addEventListener("raycaster-intersection",this.onIntersection),this.el.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared);const e=new THREE.SphereGeometry(.007,12,6),t=new THREE.Mesh(e,new THREE.MeshBasicMaterial({color:0}));this.cursor=t,this.el.setObject3D("cursor",t),this.prevD=1/0},handle(e){if(this.cursor.visible=!1,this.htmlEl){const t=this.el.components.raycaster.getIntersection(this.htmlEl);if(t){const i=this.htmlEl.getObject3D("html"),o=t.uv;s.type=e,s.data.set(o.x,1-o.y),i.dispatchEvent(s),this.cursor.visible=!0,this.cursor.position.set(0,0,-1).multiplyScalar(t.distance)}}},tick(){if(this.handle("mousemove"),"proximity"===this.data.activationType){const e=this.data.proximityElA?.object3D,t=this.data.proximityElB?.object3D;if(e&&t){const i=e.getWorldPosition(r),o=t.getWorldPosition(l),n=i.distanceTo(o);n<=this.data.proximityTrigger&&this.prevD>this.data.proximityTrigger&&this.handle("mousedown"),n>this.data.proximityTrigger&&this.prevD<=this.data.proximityTrigger&&(this.handle("mouseup"),this.handle("click")),this.prevD=n}}},update(e={}){if(e.downEvents)for(const t of e.downEvents)this.el.removeEventListener(t,this.onDown);if(e.upEvents)for(const t of e.upEvents)this.el.removeEventListener(t,this.onUp);if(e.clickEvents)for(const t of e.clickEvents)this.el.removeEventListener(t,this.onClick);if("event"===this.data.activationType){for(const e of this.data.downEvents)this.el.addEventListener(e,this.onDown);for(const e of this.data.upEvents)this.el.addEventListener(e,this.onUp);for(const e of this.data.clickEvents)this.el.addEventListener(e,this.onClick)}},remove(){this.el.removeEventListener("raycaster-intersection",this.onIntersection),this.el.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),this.el.removeObject3D("cursor")}}),AFRAME.registerComponent("html",{schema:{type:"selector"},init(){this.rerender=this.rerender.bind(this)},update(){if(this.remove(),!this.data)return;const e=new t(this.data);this.el.setObject3D("html",e),this.data.addEventListener("input",this.rerender),this.data.addEventListener("change",this.rerender)},rerender(){const e=this.el.getObject3D("html");e&&!e.material.map.scheduleUpdate&&(e.material.map.scheduleUpdate=setTimeout((()=>e.material.map.update()),16))},remove(){this.el.getObject3D("html")&&(this.el.removeObject3D("html"),this.data.removeEventListener("change",this.rerender))}})}(THREE);
//# sourceMappingURL=aframe-html.min.js.map
